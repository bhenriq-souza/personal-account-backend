resources:
  Resources:
    # IAM
    BankAccountLambdaRole:
      Type: AWS::IAM::Role
      Properties:
        RoleName: BankAccountLambdaRole
        AssumeRolePolicyDocument:
          Version: '2012-10-17'
          Statement:
            Action:
              - dynamodb:DescribeTable
              - dynamodb:Query
              - dynamodb:GetItem
              - dynamodb:PutItem
              - dynamodb:UpdateItem
              - dynamodb:DeleteItem
            Resource:
              - !Sub arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${self:custom.tables.banks}*
              - !Sub arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${self:custom.tables.bank-accounts}*
    # DynamoDB
    BanksTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: ${self:custom.tables.banks}
        AttributeDefinitions:
        - AttributeName: code
          AttributeType: S
        - AttributeName: name
          AttributeType: S
        KeySchema:
        - AttributeName: code
          KeyType: HASH
        - AttributeName: name
          KeyType: RANGE
        ProvisionedThroughput:
          ReadCapacityUnits: 2
          WriteCapacityUnits: 2
    BankAccountsTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: ${self:custom.tables.bank-accounts}
        AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
        - AttributeName: bankNumber
          AttributeType: S
        KeySchema:
        - AttributeName: id
          KeyType: HASH
        - AttributeName: bankNumber
          KeyType: RANGE
        ProvisionedThroughput:
          ReadCapacityUnits: 2
          WriteCapacityUnits: 2
